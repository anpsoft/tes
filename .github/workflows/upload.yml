name: Upload Keepalive File

on:
  schedule:
    - cron: '0 0 * * 0'  # Every Sunday at midnight UTC
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install rclone
      run: |
        curl -O https://downloads.rclone.org/rclone-current-linux-amd64.zip
        unzip rclone-current-linux-amd64.zip
        cd rclone-*-linux-amd64
        sudo cp rclone /usr/bin/
        rclone version

    - name: Set up rclone for Blomp
      run: |
        mkdir -p ~/.config/rclone
        echo "${{ secrets.RCLONE_CONFIG_BLOMP }}" > ~/.config/rclone/rclone.conf
        echo "${{ secrets.RCLONE_CONFIG_BLOMP_ENCRYPTED }}" >> ~/.config/rclone/rclone.conf
        echo "${{ secrets.RCLONE_CONFIG_BLOMP_CHUNKER }}" >> ~/.config/rclone/rclone.conf

    - name: Upload keepalive file to Blomp
      run: |
        echo "Keepalive file" > keepalive.txt
        rclone copy keepalive.txt blomp:/KeepAliveFolder --log-level DEBUG
